openapi: '3.0.2'
info:
  title: Deposit service
  version: '1.0'
  description: |
    ### Сервис для работы с депозитами клиентов интернет-банка
    Позволяет решать задачи управления депозитами физических и юридических лиц.

    Предоставляет функциональность:
    * открытие и закрытие депозита;
    * получение списка продуктовых предложений по депозитам;
    * получение списка открытых и закрытых депозитов;
    * получение операций по группе депозитов.

servers:
  - url: https://api.example.com
    description: SwaggerHub API Auto Mocking
  - url: '{protocol}://{server}:{port}'
    description: Local server
    variables:
      protocol:
        default: 'http'
      server:
        default: 'localhost'
      port:
        default: '7019'
paths:
  /customers/{client-type}/rates:
    get:
      summary: Получить доступные к открытию депозиты для пользователя
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
        - in: path
          name: client-type
          required: true
          schema:
            type: string
            enum:
              - private
              - sole-proprietor
              - customer
          description: |
            Категория продуктов для:
            * `corporate` - юридического лица

            * `sole-proprietor` - индивидуального предпринимателя
            
            * `private` - физического лица
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DepositRate'
              examples:
                Private:
                  value:
                    id: 800936587281
                    typeCode: "1610"
                    parentTypeCode: "1610"
                    type: "Пенсионный online"
                    termsUrl: "https://www.bspb.ru/retail/deposits/pensionnyj-online/"
                    online: true
                    customPeriod: false
                    topupAllowed: true
                    reinvestInterest: true
                    cancellationAllowed: false
                    initialAmountWithdrawAllowed: false
                    interestWithdrawAllowed: false
                    prolongationAllowed: true
                    hidden: false
                    interestsPayments: "MONTHLY"
                    currency: "RUB"
                    minAmount: 1000.00
                    maxAmount: 100000000.00
                    minTopUpAmount: 0.01
                    minDays: 367
                    rate: 4.0
                    dynamicRatesDescription: ""
                    cancellationPenalties: {}
                    validSince: "2019-07-15T00:00:00.000"
                    prolongationTypeCode: "1611"
                    raised: false
                Сorporate:
                  value:
                    id : 672108579681
                    typeCode: "5201"
                    type: "Срочный депозит"
                    termsUrl: ""
                    online: false
                    customPeriod: true
                    topupAllowed: false
                    reinvestInterest: false
                    cancellationAllowed: false
                    initialAmountWithdrawAllowed: false
                    interestWithdrawAllowed: false
                    prolongationAllowed: false
                    hidden: false
                    interestsPayments: "MATURITY"
                    currency: "RUB"
                    minAmount: 10000.00
                    maxAmount: 100000000.00
                    minTopUpAmount: 0.00
                    minDays: 1096
                    rate: 6.90
                    dynamicRatesDescription: ""
                    cancellationPenalties: { "0": 0.01 }
                    validSince: "2018-09-03T00:00:00.000"
                    raised: false
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /customers/private/{dboId}/deposits:
    get:
      summary: Получить текущие депозиты ФЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
        - $ref: '#/components/parameters/DBO-ID'
        - $ref: '#/components/parameters/CloseFilter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Deposit'
        '4XX':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /customers/corporate/{dboId}/deposits:
    get:
      summary: Получить текущие депозиты ЮЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
        - $ref: '#/components/parameters/DBO-ID'
        - $ref: '#/components/parameters/CloseFilter'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Deposit'
        '4XX':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /customers/private/{dboId}/transactions:
    get:
      summary: Получить операции по депозиту ФЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
        - $ref: '#/components/parameters/DBO-ID'
        - $ref: '#/components/parameters/Deposit-IDs'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DepositTransaction'
        '4XX':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '504':
          $ref: '#/components/responses/GatewayTimeout'
  /customers/private/{dboId}/place:
    post:
      summary: Открыть депозит ФЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '200':
          description: OK
  /customers/private/{dboId}/close/{depositId}:
    post:
      summary: Закрыть депозит ФЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '200':
          description: OK

  /customers/corporate/{dboId}/transactions:
    get:
      summary: Получить операции по депозиту ЮЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '200':
          description: OK
  /customers/corporate/{dboId}/place:
    post:
      summary: Открыть вклад ЮЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '200':
          description: OK
  /customers/corporate/{dboId}/close/{depositId}:
    post:
      summary: Закрыть вклад ЮЛ
      parameters:
        - $ref: '#/components/parameters/X-Request-ID'
      responses:
        '200':
          description: OK
components:
  schemas:
    Error:
      title: Default Error
      type: object
      properties:
        statusCode:
          type: integer
        massage:
          type: string
    User:
      title: User
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 'Идентификатор Клиента.'
          example: 5110621
        privateCustomerId:
          type: integer
          format: int64
          description: 'Идентификатор Распорядителя ЮЛ. Для ФЛ = id.'
          example: 157512303
        locale:
          type: string
          description: 'Язык локализации'
          example: "ru"
    DepositRate:
      title: Deposit's rate
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 'ID схемы начисления процентов для 
          определенного вида депозитного договора.'
          example: 800936587281
        typeCode:
          type: string
          description: 'Код вида депозитного договора в ЦФТ.'
          nullable: true
          example: "1610"
        parentTypeCode:
          type: string
          description: 'Код вида вклада для доп. вложения.'
          nullable: true
          example: "1610"
        type:
          type: string
          description: 'Наименование вклада.'
          nullable: true
          example: "Пенсионный online"
        termsUrl:
          type: string
          description: 'Ссылка на страницу ИБ с 
          подробным описанием депозита.'
          nullable: true
          example: "https://www.bspb.ru/retail/deposits/pensionnyj-online/"
        online:
          type: boolean
          description: 'Признак возможности открытия вклада 
          online в ИБ.'
          example: true
        customPeriod:
          type: boolean
          description: 'Вернёт "true", если у вида вклада в АБС
          есть ссылка на справочник «СПБ. Депозиты особые условия».'
          example: false
        topupAllowed:
          type: boolean
          description: 'Признак возможности 
          пополнения/дополнительных взносов.'
          example: true
        reinvestInterest:
          type: boolean
          description: 'Признак реинвестирования накопленных 
          процентов.'
          example: true
        cancellationAllowed:
          type: boolean
          description: 'Признак возможности досрочного закрытия 
          вклада.'
          example: false
        initialAmountWithdrawAllowed:
          type: boolean
          description: 'Признак возможности снятия средств с 
          депозитного договора.'
          example: false
        interestWithdrawAllowed:
          type: boolean
          description: 'Признак возможности снятия накопленных 
          процентов.'
          example: false
        prolongationAllowed:
          type: boolean
          description: 'Признак возможности пролонгации депозита.'
          example: true
        hidden:
          type: boolean
          description: 'Возвращается "true", если typeCode 
          1621, 1622 или 300.'
          example: false
        interestsPayments:
          type: string
          description: 'Период выплаты процентов. Значения:
          MONTHLY, QUARTERLY, MATURITY.'
          example: 'MONTHLY'
        currency:
          type: string
          description: 'Валюта вклада.'
          example: "RUB"
        minAmount:
          type: number
          description: 'Минимальная сумма вклада.'
          example: 1000.00
        maxAmount:
          type: number
          description: 'Максимальная сумма вклада.'
          example: 5000000.00
        minTopUpAmount:
          type: number
          description: 'Минимальная сумма пополнения депозита.'
          example: 0.01
        maxTopUpAmount:
          type: number
          description: 'Максимальная сумма пополнения депозита.'
          example: 5000000.00
        minDays:
          type: integer
          description: 'Минимальный срок вклада для случаев вручную 
          указываемого срока или свободного срока.'
          example: 367
        rate:
          type: number
          description: 'Ставка, % годовых.'
          example: 4.0
        rateExtra:
          type: number
          description: 'Значение уточняется.'
          deprecated: true
          example: 4.0
        dynamicRatesDescription:
          type: string
          description: 'dynamicRatesDescription.'
          example: "Ставка LIBOR overnight - 1.4%"
        cancellationPenalties:
          description: 'Штрафная процентная ставка при досрочном 
          закрытии вклада.'
        validSince:
          type: string
          format: date-time
          description: 'Дата, с которой можно открывать вклад.'
        prolongationTypeCode:
          type: string
          description: 'Код вида договора для автоматической 
          пролонгации.'
          example: "1611"
        raised:
          type: boolean
          description: 'Всегда возвращает false.'
          example: false
    Deposit:
      title: Customer's deposit
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 'ID депозита.'
          example: 136339851112
        amount:
          type: number
          description: 'Текущая сумма вклада.'
          example: 71759.4
        until:
          type: string
          format: date-time
          description: 'Дата закрытия/пролонгации депозита.'
          nullable: true
          example: "2020-01-25T00:00:00.000"
        orderDate:
          type: string
          format: date-time
          description: 'Дата создания вклада.'
          example: "2019-01-23T00:00:00.000"
        startDate:
          type: string
          format: date-time
          description: 'Дата начала действия вклада.'
          example: "2015-01-16T18:47:00.000"
        days:
          type: integer
          description: 'Срок, на который открыт депозит.'
          nullable: true
          example: 367
        type:
          type: string
          description: 'Наименование вклада.'
          example: "Престиж online c пролонгацией"
        typeCode:
          type: string
          description: 'Код вида депозитного договора в ЦФТ.'
          example: "1521"
        currency:
          type: string
          description: 'Валюта депозита'
          example: "RUB"
        topupAllowed:
          type: boolean
          description: 'Признак возможности пополнения.'
          example: true
        WithdrawAllowed:
          type: boolean
          description: 'Признак возможности снятия средств с депозита.'
          example: true
        prolongation:
          type: boolean
          description: 'Признак пролонгации'
          example: true
        cancellationDate:
          type: string
          format: date-time
          description: 'ToDo уточнить!'
          nullable: true
          example:
          deprecated: true
        # Параметра нет в описании к API. #ToDo: уточнить!
        cancellationReason:
          type: string
          description: ''
          nullable: true
          example:
          deprecated: true
        interestPayoutPeriod:
          type: string
          description: 'Период выплаты процентов.'
          nullable: true
          example: "Ежеквартально"
        interestPayoutToDepositAccount:
          type: boolean
          description: 'Признак "Перечислять проценты".'
          example: true
        interestPayoutToServiceAccount:
          type: boolean
          description: 'Признак "Выплачивать проценты".'
          example: false
        topupAllowedFromDay:
          type: string
          description: 'Период и единица измерения доп. взноса от начала 
          вклада.'
          nullable: true
          example: "0 Дни"
        topupAllowedUntilDay:
          type: string
          description: 'Период и единица измерения доп. взноса от конца вклада.'
          nullable: true
          example: "1 Дни"
        topupMinAmount:
          type: number
          description: 'Минимальная сумма пополнения/доп. взноса депозита.'
          nullable: true
          example: 10000.00
        partialPayoutAllowedFromDay:
          type: string
          description: 'Период и единица измерения для изъятия от начала 
          вклада.'
          nullable: true
          example: "30 Дни"
        partialPayoutAllowedUntilDay:
          type: string
          description: 'Период и единица измерения для изъятия от конца вклада.'
          nullable: true
          example: "90 Дни"
        partialPayoutMaxAmount:
          type: string
          description: 'Условие выполнений операций по договору.'
          nullable: true
          example: "Общий размер изъятий не более 50% от суммы вклада на момент 
          открытия"
        prematureEnd:
          type: string
          description: 'Период применения штрафной ставки.'
          nullable: true
          example: "С даты начала действия/последней пролонгации"
        status:
          type: string
          description: 'Текущий статус вклада. Доступны значения: PENDING, 
          ACTIVE, CLOSED, REJECTED, CLOSING, UNKNOWN'
          example: "CLOSING"
        agreementNumber:
          type: string
          description: 'Номер депозитного договора.'
          nullable: true
          example: "55/1521/15-00062878"
        nextInterestPaymentDay:
          type: string
          format: date-time
          description: 'Дата следующей выплаты % по вкладу.'
          nullable: true
          example: "2019-07-23T00:00:00.000"
        description:
          type: string
          description: 'Наименование вклада.'
          nullable: true
          example: "Престиж online c пролонгацией"
        # Параметра нет в описании к API. #ToDo: уточнить!
        minAmount:
          type: number
          description: ''
          nullable: true
          example:
          deprecated: true
        onlineWithdrawAllowed:
          type: boolean
          description: 'Признак, что online - списание доступно только для 
          активных вкладов с typeCode = PremiumUprav'
          example: false
        closeableOnline:
          type: boolean
          description: 'Признак возможности закрытия депозита через ИБ online.'
          example: false
        account:
          $ref: '#/components/schemas/Account'
          description: 'Счет депозита.'
        serviceAccount:
          $ref: '#/components/schemas/Account'
          description: 'Обслуживающий счет.'
          nullable: true
        # Параметра нет в описании к API. #ToDo: уточнить!
        minBalanceForPeriod:
          type: number
          description: ''
          nullable: true
          deprecated: true
        periodInterestAmount:
          type: number
          description: 'Проценты по вкладу за период.'
          nullable: true
          example: 1866.14
        rate:
          type: number
          description: 'Ставка по вкладу.'
          example: 6.9
        # Параметра нет в описании к API. #ToDo: уточнить!
        rateExtra:
          type: number
          description: ''
          nullable: true
          deprecated: true
        # Параметра нет в описании к API. #ToDo: уточнить!
        thresholdAmount:
          type: number
          description: ''
          nullable: true
          deprecated: true
        history:
          type: array
          items:
            type: integer
            format: int64
          description: 'Массив фактических операций.'
    Account:
      title: Customer's account
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 'ID счёта в ЦФТ.'
          example: 86185712766
        bic:
          type: string
          description: 'Банковский идентификационный код.'
          nullable: true
          example: "044030790"
        number:
          type: string
          description: 'Номер счёта.'
          example: "40817810190550019977"
        currency:
          type: string
          description: 'Валюта счёта.'
          example: "RUB"
        type:
          type: string
          description: 'Тип счёта. Значения: CURRENT, DEPOSIT, LOAN, 
          MARGIN, BROKER, SAVINGS'
          example: "CURRENT"
        balance:
          type: number
          description: 'Текущий баланс счёта.'
          example: 100.00
        # Параметра нет в описании к API. #ToDo: уточнить!
        description:
          type: string
          description: 'Название счёта.'
          nullable: true
          example: "Счёт клиента банка."
          deprecated: true
    DepositTransaction:
      title: Deposit's transaction
      type: object
      properties:
        rate:
          type: number
          description: 'Ставка.'
          nullable: true
          example: 5.90
        cftId:
          type: integer
          format: int64
          description: 'ID фактической операции.'
          nullable: true
          example: 827152060552
        description:
          type: string
          description: 'Описание транзации.'
          example: "INITIAL"
        amount:
          type: number
          description: 'Сумма операции (относительно Клиента).'
          example: -73625.54
        time:
          type: string
          format: date-time
          description: ''
          example: "2019-09-06T00:00:00.000"
        currency:
          type: string
          description: 'ISO код валюты операции.'
          example: "643"
    DepositOrder:
      title: Deposit's order
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 'ID депозита.'
          nullable: true
          example: 302021946096
        rate:
          type: number
          description: 'Ставка.'
          example: 6.11
        amount:
          type: number
          description: 'Сумма вклада.'
          example: 5000.00
        currency:
          type: string
          description: 'Код валюты.'
          example: "RUB"
        days:
          type: integer
          description: 'Срок вклада.'
          example: 367
        customerRef:
          type: string
          description: 'ДБО ID клиента.'
          example: 9088119174
        start:
          type: string
          format: date-time
          description: 'Дата начала действия вклада.'
          nullable: true
          example: "2019-10-10T17:17:14.366"
        orderDate:
          type: string
          format: date-time
          description: 'Дата создания вклада.'
          example: "2019-10-10T17:17:14.365"
        type:
          type: string
          description: 'Наименование вклада из ЦФТ.'
          example: "Рантье online"
        typeCode:
          type: string
          description: 'Идентификатор типа вклада из ЦФТ.'
          example: "1523"
        autoProlongation:
          type: boolean
          description: 'Флаг автоматического продлевания на новый срок после 
          окончания срока вклада.'
          example: true
        topupAllowed:
          type: boolean
          description: 'Признак возможности пополнения.'
          example: true
        withdrawAllowed:
          type: boolean
          description: 'Признак возможности частичного снятия.'
          example: true
        ip:
          type: string
          description: 'IP-адрес стойки, с которой был открыт вклад.'
          nullable: true
          example: "127.0.0.1"
        # Нет в описании к API и в примерах. ToDo уточнить!
        status:
          type: string
          description: ''
          nullable: true
          deprecated: true
          example: "DEFERRED"
        skipInitialPayment:
          type: boolean
          description: 'Признак возможности открытя вклада без первоначального 
          платежа. Необходим для открытия накопительного счета.'
          example: false
        rateId:
          type: integer
          format: int64
          description: 'Идентификатор ставки вклада.'
          nullable: true
          example: 826316390784
        payoutAccountId:
          type: integer
          format: int64
          description: '	ID счета для возврата депозита и процентов.'
          nullable: true
          example: 58226261134
        serviceAccountId:
          type: integer
          format: int64
          description: 'ID обслуживающего счета.'
          nullable: true
          example: 64741900148
        user:
          $ref: '#/components/schemas/User'
    # Объёкт Deposit с доп. свойством InitialPaymentId
    DepositWithInitialPaymentId:
      title: Deposit with InitialPaymentId
      allOf:
        - $ref: '#/components/schemas/Deposit'
        - type: object
          properties:
            # В описании к API нет данного парметра. ToDo Уточнить!
            InitialPaymentId:
              type: integer
              format: int64
              description: ''
              nullable: true
              deprecated: true
              example:
  parameters:
    X-Request-ID:
      in: header
      name: RequestId
      schema:
       type: string
       format: uuid
       example: 123e4567-e89b-12d3-a456-426655440000
      required: true
      description: UUID для логгирования запроса.
    DBO-ID:
      in: path
      name: dboId
      schema:
        type: integer
        format: int64
      required: true
      description: Номер ID ДБО клиента.
    CloseFilter:
      in: query
      name: close
      schema:
        type: boolean
        default: false
      required: false
      description: |
        Фильтрация депозитов по статусу:
        * `false`- возвращает открытые депозиты Клиента.

        * `true` - возвращает закрытые депозиты Клиента.
    Deposit-IDs:
      in: query
      name: depositIds
      schema:
        type: array
        items:
          type: integer
          format: int64
        minItems: 1
      explode: false
      required: true
      description: Номера ID депозитов для получения.
    # Почему обязательно указывается у ЮЛ?
    Mandate-ID:
      in: query
      name: mandateId
      schema:
        type: integer
        format: int64
      required: true
      description: Номер ID ДБО Распорядителя Клиента ЮЛ.
  responses:
    GatewayTimeout:
      description: Gateway Timeout
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            statusCode: 504
            massage: "Remote services are unavailable"
    BadRequest:
      description: Bad Request response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            statusCode: 400
            massage: "Request parameter is missing"
    UnprocessableEntity:
      description: Unprocessable Entity
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'